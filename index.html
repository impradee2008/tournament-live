<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Leander Badminton Live - Tournament Manager</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Live badminton tournament scores, schedules, and leaderboards for Leander Badminton Club.">

    <!-- Favicon -->
    <link rel="icon" href="https://leanderbadminton.store/favicon.ico">

    <style>
        body, html { margin: 0; padding: 0; height: 100%; width: 100%; overflow: hidden; background-color: #f5f5f5; }
        iframe { width: 100%; height: 100%; border: none; display: block; }
        #loading { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); font-family: sans-serif; color: #666; }
    </style>
</head>
<body>
<div id="loading">Loading Tournament...</div>
<iframe id="appFrame" allow="clipboard-write"></iframe>

<script>
    // --- CONFIGURATION ---
    const GAS_URL = "https://script.google.com/macros/s/AKfycbwO27tmLY2Inn4cLqmuZ6S-HycFNQF9JlS2Cew0BAHIUMzLCgrUn8TuxhBAIewdqhiWng/exec";

    // --- LOGIC ---
    const params = window.location.search;
    const finalUrl = GAS_URL + params;

    const iframe = document.getElementById('appFrame');
    iframe.src = finalUrl;

    iframe.onload = function() {
        document.getElementById('loading').style.display = 'none';
    };
</script>

<script>
    window.addEventListener('message', function(event) {
      // Verify origin for security - only accept messages from Google Apps Script
      if (!event.origin.includes('script.google.com')) {
        console.log('Ignoring message from unauthorized origin:', event.origin);
        return;
      }

      if (event.data.type === 'navigationRequest') {
        console.log('Navigation request received:', event.data);

        try {
          // Find the iframe containing the badminton app
          const iframe = document.querySelector('iframe[src*="script.google.com"]');
          if (iframe) {
            console.log('Found iframe, updating src to:', event.data.url);

            // Update iframe src to trigger navigation
            iframe.src = event.data.url;

            // Send success response back to iframe
            event.source.postMessage({
              requestId: event.data.requestId,
              success: true,
              message: 'Navigation successful',
              timestamp: Date.now()
            }, event.origin);

            console.log('Navigation completed successfully');
          } else {
            throw new Error('Badminton app iframe not found on page');
          }
        } catch (error) {
          console.error('Navigation failed:', error);

          // Send error response back to iframe
          event.source.postMessage({
            requestId: event.data.requestId,
            success: false,
            error: error.message,
            timestamp: Date.now()
          }, event.origin);
        }
      }
    });

    // Log that the listener is ready
    console.log('Badminton Tournament App message listener initialized');
</script>
</body>
</html>